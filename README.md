# Chan Theory Visualizer (缠论可视化工具)

这是一个基于 Python 的缠论（Chan Theory）量化分析与可视化工具。它能够实时获取股市数据（以沪深300指数为例），进行缠论核心逻辑计算（包含处理、分型、笔），并生成交互式的 K 线图表。

## 主要功能

1.  **多市场支持**:
    *   **A股**: 支持股票代码（如 `600519`）、指数代码（如 `000300`）。
    *   **港股**: 支持 5位数字代码（如 `00700`, `01810`），或带后缀格式（如 `01810.HK`）。
    *   **美股**: 支持股票代码（如 `AAPL`, `TSLA`），或带后缀格式（如 `AAPL.US`），程序自动识别并获取数据。
2.  **实时数据获取**: 集成 `AkShare` 接口，支持获取 1分钟、5分钟、30分钟及日线级别的实时/历史行情数据。
3.  **缠论核心计算**:
    *   **K线包含处理**: 处理 K 线间的包含关系。
    *   **顶底分型**: 识别顶分型和底分型。
    *   **笔 (Bi)**: 基于严格的 "5K原则" 和分型力度检查，自动画笔。
4.  **多维度可视化**:
    *   **Panel 1**: 原始 K 线图。
    *   **Panel 2**: 缠论标准 K 线（变宽 K 线）+ 笔走势叠加。
5.  **多种运行模式**:
    *   **GUI 模式**: 图形化界面，支持一键切换常用周期组合 (如 1分钟/1天, 5分钟/15天等)。
    *   **自定义模式**: 命令行/独立窗口，支持指定任意起止日期和周期进行回溯分析。

## 环境依赖

*   Python 3.8+
*   依赖库:
    *   `pandas`
    *   `matplotlib`
    *   `mplfinance`
    *   `akshare`
    *   `tkinter` (Python 内置)

安装命令:
```bash
pip install pandas matplotlib mplfinance akshare
```

## 快速开始

### 1. GUI 主程序 (推荐)
双击运行 `run.bat` (或执行 `python main.py`)。
*   提供 7 种预设场景（如 1分钟/1天、5分钟/15天、日线/60天等）。
*   支持后台异步加载数据，操作流畅。
*   数据加载完成后自动刷新图表。

### 2. 自定义数据回溯
双击运行 `custom_run.bat` (或执行 `python custom_runner_gui.py`)。
*   弹出配置窗口。
*   选择 K 线周期 (1/5/30 min)。
*   选择精确的 **开始日期** 和 **结束日期**。
*   点击 "Fetch Data & Plot" 查看结果。

## 项目结构

*   `main.py`: 程序入口，启动 GUI 主程序。
*   `gui_app.py`: GUI 界面逻辑实现 (Tkinter)。
*   `custom_runner_gui.py`: 自定义查询工具的 GUI 实现。
*   `chan_core.py`: 缠论核心算法库 (包含处理、分型、画笔)。
*   `data_fetcher.py`: 数据获取模块 (封装 AkShare)。
*   `visualizer.py`: 绘图模块 (封装 mplfinance)。
*   `run.bat`: GUI 主程序启动脚本。
*   `run_custom.bat`: 自定义查询工具启动脚本。

## 备忘录 (Memo) & 常见问题 (FAQ)

### 1. 1分钟 K 线数据源异常 (绿色实心块问题)
**说明**: 在获取某些历史日期（如 2025年12月18日）的 1分钟 K 线时，数据源返回的 **Open (开盘价) 为 0.0**，导致 K 线图显示异常（巨大的实体柱）。
**妥协处理**: 为了保证图表可读性，程序在 `data_fetcher.py` 中增加了清洗逻辑：当检测到 `Open <= 0` 时，强制将其替换为当根 K 线的 `Close` 值。这会使该分钟 K 线显示为十字星，虽然丢失了真实开盘价（如果存在的话），但避免了图形崩溃。

### 2. 美股/港股数据查询性能
**说明**: 相比 A 股，美股数据的查询速度较慢。
**原因**:
*   上游数据源通常**只提供 1分钟级别**的历史数据接口。
*   为了支持 5/15/30 分钟 K 线，程序必须先下载指定时间段内所有的 1分钟数据，然后在本地进行重采样 (Resample) 计算。
*   美股代码需要自动匹配市场前缀（如 105.AAPL, 106.F），增加了额外的网络试错开销。
**现状**: 这是受限于免费数据源接口特性的折衷方案。
